<html>
<head>
<title>
Comments
</title>
<link rel="stylesheet" type="text/css" href="style.css"/>
<script>
var loggedinFlag=false;
var request=new XMLHttpRequest();
request.onreadystatechange=function()
{
    if(request.readyState===XMLHttpRequest.DONE)
    {
        if(request.status===200)
        {   
            loggedinFlag=true;
        }else{
            loggedinFlag=false;
        }
    }
};
request.open('GET','http://vidhiyakar.imad.hasura-app.io/checklogin',true);
request.send(null);
function myFunction() {
    document.getElementById("myDropdown").classList.toggle("show");
}
function fetchComments(){
    var commentsElement = document.getElementById("comments");
    var request=new XMLHttpRequest();
    request.onreadystatechange=function()
    {
        if(request.readyState===XMLHttpRequest.DONE)
        {
            if(request.status ===200){
                commentsElement.innerHTML = request.responseText.toString();
            }
        }
    };
    request.open('GET','http://vidhiyakar.imad.hasura-app.io/getcomments',true);
    request.send(null);
}
function addComment(){
    if(loggedinFlag === true){
        var commentElement=document.getElementById('commenttext');
        var commentText=commentElement.value.toString();
        var request=new XMLHttpRequest();
        request.onreadystatechange=function()
        {
            if(request.readyState===XMLHttpRequest.DONE)
            {
                if(request.status===200)
                {
                    fetchComments();
                    commentElement.value="";
                }else{
                    alert('Comment failed.. Please login to comment..');
                }
            }
        };
        request.open('GET','http://vidhiyakar.imad.hasura-app.io/addcomments/'+commentText,true);
        request.send(null);
    }else{
        alert('Please Login to comment');
    }
}
</script>
</head>
<body onload='fetchComments()'>
    <br>
    <div class="dropdown">
    <button onmouseover="myFunction()" class="dropbtn">Articles</button>
    <div id="myDropdown" class="dropdown-content">
        <a href="/">Home</a>
        <a href="/resume">Resume</a>
        <a href="/comment">Comments</a>
    </div>
    </div>
    <div class="content">
        <h1>Comments</h1>
        <hr size="5" color="#ffffff" noshade>
<table width="100%" class="content" style="text-align:left">
<tr><td width="50%"><center><h3>Existing Comments</h3></center>
<table width="100%" class="content" style="text-align:left">
<tr height="50px" style="font-size:20px"><th width="30%">Username</th><th>Comment</th></tr>
<tr><td colspan="2">
<div style="overflow-x:hidden; verflow-y:scroll; height:250px; width:100%; text-align:left">
<span id="comments"></span>
</div></td>
</tr>
</table></td><td width="1px" bgcolor="#ffffff"></td>

<td>
    <center><h2>Add Comments</h2></center>
    <br>
    <br>
    <div style="margin:20px; text-size:25px">
    Enter your comment here<br><br>
    <textarea id="commenttext" style="width:100%; height:150px"></textarea><br><br>
    <input type="button" id="addcomment" value="Add Comment" onclick="addComment()"/><br>
    </div>
</td>

</tr>
</table>
</div>
</body>
</html>